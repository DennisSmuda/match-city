(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&c(l)}).observe(document,{childList:!0,subtree:!0});function i(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(o){if(o.ep)return;o.ep=!0;const n=i(o);fetch(o.href,n)}})();const r={keyframesIn:[{scale:.8},{scale:1.1},{scale:1}],keyframesOut:[{scale:1},{scale:1.1},{scale:.2}],keyframesDisappear:[{scale:1,opacity:1},{scale:.2,opacity:0}],timing:{easing:"cubic-bezier(0.42, 0, 0.58, 1)",duration:130},timingShort:{easing:"cubic-bezier(0.42, 0, 0.58, 1)",duration:80},timingLong:{easing:"cubic-bezier(0.42, 0, 0.58, 1)",duration:240}};const a=document.getElementById("game-over"),g=document.getElementById("next-tile-container");let s={},m={},u=0,y=!1;a.style.opacity="0";a.style.pointerEvents="none";const b=async()=>{const e=document.createElement("div");e.classList.add("tile","next"),e.setAttribute("data-type",k()),e.innerHTML="1",g==null||g.appendChild(e),await e.animate(r.keyframesIn,r.timing).finished},T=async()=>{const e=document.createElement("div");e.classList.add("tile"),e.setAttribute("data-type",k()),e.innerHTML="1";const{x:t,y:i}=L(),c=document.querySelector(`[data-grid-pos="${t}:${i}"]`);s[`${t}:${i}`]=e.getAttribute("data-type"),c==null||c.appendChild(e),await e.animate(r.keyframesIn,r.timing).finished,await p(t,i)},L=()=>{let e=null;for(;!e;){let t=Math.floor(Math.random()*5),i=Math.floor(Math.random()*5);s[`${t}:${i}`]||(e={x:t,y:i})}return e},p=async(e,t)=>{console.log("Check grid for",e,t);const i=s[`${e}:${t}`],c=document.querySelector(`[data-grid-pos="${e}:${t}"] > .tile`);let o=0;for(let n=e-1;n>=e-4&&s[`${n}:${t}`]===i;n--)m[`${n}:${t}`]=!0,o++;for(let n=e+1;n<=e+4&&s[`${n}:${t}`]===i;n++)m[`${n}:${t}`]=!0,o++;for(let n=t+1;n<=t+4&&s[`${e}:${n}`]===i;n++)m[`${e}:${n}`]=!0,o++;for(let n=t-1;n>=t-4&&s[`${e}:${n}`]===i;n--)m[`${e}:${n}`]=!0,o++;if(o>=2){let n=0;for(const l in m)if(Object.prototype.hasOwnProperty.call(m,l)){const d=document.querySelector(`[data-grid-pos="${l}"] > .tile`),f=parseInt((d==null?void 0:d.innerHTML)||"1")+parseInt(c.innerHTML);c.innerHTML=f.toString(),u+=f,n+=f;const $=document.getElementById("score");$.innerHTML=u.toString(),await(d==null?void 0:d.animate(r.keyframesOut,r.timingShort).finished),d==null||d.remove(),delete m[l],delete s[l]}h(n)}m={}},E=async(e,t,i)=>{if(y||(y=!0,s[`${t}:${i}`]))return;const o=document.querySelectorAll(".tile.next")[0];console.log("tile",o),o.animate(r.keyframesOut,r.timing).finished,e.appendChild(o),s[`${t}:${i}`]=o.getAttribute("data-type"),o.classList.remove("next"),await o.animate(r.keyframesIn,r.timing).finished,await b(),await p(t,i),console.log("Finish checking grid after click"),Object.keys(s).length<=23&&await T(),console.log("Check if game over",Object.keys(s).length),Object.keys(s).length>=25&&v(),console.log("Finish"),y=!1},S=()=>{document.querySelectorAll(".cell").forEach(t=>{const i=t.getAttribute("data-grid-pos")||"0:0",[c,o]=i.split(":");console.log("Cell Pos: ",c,o),t.addEventListener("click",E.bind(null,t,parseInt(c),parseInt(o)))})};S();const I=document.querySelectorAll(".tile")[0];console.log("tile",I);document.body.onkeyup=function(e){(e.key==" "||e.code=="Space"||e.keyCode==32)&&h(12)};const h=async e=>{const t=document.getElementById("score"),i=document.createElement("div");i.classList.add("floating-text","score"),i.innerHTML=`+${e.toString()}`,t==null||t.appendChild(i),await i.animate([{transform:"translateY(0)"},{transform:"translateY(-1rem)",opacity:0}],500).finished,i.remove()},k=()=>{let e=Math.random(),t="green";return e<.3?t="pink":e<.6&&(t="blue"),t},v=async()=>{var t;const e=document.getElementById("final-score");e.innerHTML=u.toString(),a.style.visibility="visible",a.style.pointerEvents="auto",a.style.opacity="1",await(a==null?void 0:a.animate(r.keyframesIn,r.timingShort).finished),(t=document.getElementById("restart-game-button"))==null||t.addEventListener("click",w.bind(null,u,s))},w=async()=>{console.log("Restart Game"),document.querySelectorAll(".tile:not(.next)").forEach(async i=>{i.innerHTML="",await(i==null?void 0:i.animate(r.keyframesOut,r.timingLong).finished),i==null||i.remove()}),await(a==null?void 0:a.animate(r.keyframesDisappear,r.timingShort).finished),a.style.opacity="0",a.style.pointerEvents="none",u=0;const t=document.getElementById("score");t.innerHTML=u.toString(),s={}};
